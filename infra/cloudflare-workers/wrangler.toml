name = "heady-edge-router"
main = "index.ts"
compatibility_date = "2024-01-01"
node_compat = true

[env.production]
name = "heady-edge-router"
routes = [
  { pattern = "headysystems.com/*", zone_name = "headysystems.com" },
  { pattern = "headyconnection.org/*", zone_name = "headyconnection.org" },
  { pattern = "api.headysystems.com/*", zone_name = "headysystems.com" }
]
vars = { ENVIRONMENT = "production" }

[env.production.vars]
HEADY_API_URL = "https://heady-automation-ide.onrender.com"
HEADY_CONNECTION_URL = "https://heady-connection.onrender.com"
HEADY_SYSTEMS_URL = "https://heady-systems.onrender.com"

[[env.production.kv_namespaces]]
binding = "KV_CACHE"
id = "your_kv_namespace_id"

[[env.production.analytics_engine_datasets]]
binding = "ANALYTICS"

[env.staging]
name = "heady-edge-router-staging"
routes = [
  { pattern = "staging.headysystems.com/*", zone_name = "headysystems.com" },
  { pattern = "staging.headyconnection.org/*", zone_name = "headyconnection.org" }
]

[env.staging.vars]
HEADY_API_URL = "https://heady-automation-ide-staging.onrender.com"
HEADY_CONNECTION_URL = "https://heady-connection-staging.onrender.com"
HEADY_SYSTEMS_URL = "https://heady-systems-staging.onrender.com"

[[env.staging.kv_namespaces]]
binding = "KV_CACHE"
id = "your_staging_kv_namespace_id"

[env.development]
name = "heady-edge-router-dev"
vars = { ENVIRONMENT = "development" }

[env.development.vars]
HEADY_API_URL = "http://localhost:4100"
HEADY_CONNECTION_URL = "http://localhost:3000"
HEADY_SYSTEMS_URL = "http://localhost:3001"

[build]
command = "npm install && npm run build"

[build.upload]
format = "service-worker"
